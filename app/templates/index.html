{% extends "_base_page.html" %}
{% block page_title %}
  Digital Marketplace admin
{% endblock %}

{% block main_content %}
<div class="grid-row">
  <div class="column-two-thirds">
  {%
    with heading = "Admin"
  %}
    {% include "toolkit/page-heading.html" %}
  {% endwith %}

  {% if current_user.has_role('admin-manager') %}
    {% with items = [
      {
        "link": url_for('.manage_admin_users'),
        "title": "Manage users"
      },
    ]
    %}
      {% include "toolkit/browse-list.html" %}
    {% endwith %}
  {% endif %}

  {% if current_user.has_any_role('admin', 'admin-ccs-category') %}

    {% with
      smaller = True,
      heading = "User support"
    %}
      {% include "toolkit/page-heading.html" %}
    {% endwith %}

    {% with items = [
      {
        "link": url_for('.find_user_by_email_address'),
        "title": "Find a user by email"
      },
    ]
    %}
      {% include "toolkit/browse-list.html" %}
    {% endwith %}
  {% endif %}

  {% if current_user.has_any_role('admin', 'admin-ccs-category', 'admin-ccs-sourcing', 'admin-framework-manager') %}

    {% set link_texts = {
        'admin': 'Edit supplier accounts or view services',
        'admin-ccs-category': 'Edit suppliers and services',
        'admin-ccs-sourcing': 'Edit supplier declarations',
        'admin-framework-manager': 'View suppliers and services',
        }
    %}
    {% with items = [
      {
        "link": url_for('.find_suppliers_and_services'),
        "title": link_texts[current_user.role]
      },
    ]
    %}
      {% include "toolkit/browse-list.html" %}
    {% endwith %}

  {% endif %}

  {% if current_user.has_any_role('admin', 'admin-ccs-category') %}

    {% with items = [
      {
        "link": url_for('.find_buyer_by_brief_id'),
        "title": "Find a buyer by opportunity ID"
      },
    ]
    %}
      {% include "toolkit/browse-list.html" %}
    {% endwith %}
  {% endif %}

  {% if current_user.has_role('admin') %}
    {% with items = [
      {
        "link": url_for('.add_buyer_domains'),
        "title": "Add a buyer email domain"
      },
    ]
    %}
      {% include "toolkit/browse-list.html" %}
    {% endwith %}
  {% endif %}

  {% if current_user.has_any_role('admin-ccs-category') %}
    {% with
      smaller = True,
      heading = "Service edits"
    %}
      {% include "toolkit/page-heading.html" %}
    {% endwith %}
    {% with items = [
      {
        "link": url_for('.service_update_audits'),
        "title": "Check edits to services"
      },
    ]
    %}
      {% include "toolkit/browse-list.html" %}
    {% endwith %}
  {% endif %}

  {% if current_user.has_any_role('admin-ccs-sourcing', 'admin-framework-manager') %}
    {% with
      smaller = True,
      heading = "Statistics"
    %}
      {% include "toolkit/page-heading.html" %}
    {% endwith %}
    {% with items = [
      {
        "body": "View G-Cloud 9 statistics",
        "link": "/admin/statistics/g-cloud-9",
        "title": "G-Cloud 9 statistics"
      }
    ]
    %}
     {% include "toolkit/browse-list.html" %}
    {% endwith %}
  {% endif %}

  {% if current_user.has_any_role('admin-ccs-category', 'admin-ccs-sourcing', 'admin-framework-manager') %}
    {% with
      smaller = True,
      heading = "Agreements"
    %}
      {% include "toolkit/page-heading.html" %}
    {% endwith %}
    {% for framework in frameworks_for_countersigning %}
      {% with items = [
        {
          "body": "Approve " + framework.name + " agreements for countersigning"
                  if framework['frameworkAgreementVersion'] else
                  "Download " + framework.name + " agreements",
          "title": framework.name + " agreements",
          "link": url_for('.list_agreements', framework_slug=framework['slug'], status='signed')
        }
      ]
      %}
        {% include "toolkit/browse-list.html" %}
      {% endwith %}
    {% endfor %}
  {% endif %}

  {% if current_user.has_role('admin-framework-manager') %}
    {% set items = [
      {
        "body": "Manage G-Cloud 8 communications",
        "link": url_for(".manage_communications", framework_slug="g-cloud-8"),
        "title": "G-Cloud 8 communications"
      },
      {
        "body": "Manage Digital Outcomes and Specialists 2 communications",
        "link": url_for(".manage_communications", framework_slug="digital-outcomes-and-specialists-2"),
        "title": "Digital Outcomes and Specialists 2 communications"
      },
      {
        "body": "Manage G-Cloud 9 communications",
        "link": url_for(".manage_communications", framework_slug="g-cloud-9"),
        "title": "G-Cloud 9 communications"
      },
      {
        "body": "Download a list of users for frameworks that are open, pending or live",
        "link": url_for(".list_frameworks_with_users"),
        "title": "Download user lists"
      },
    ]
    %}

    {% with
      smaller = True,
      heading = "Communications"
    %}
      {% include "toolkit/page-heading.html" %}
    {% endwith %}

    {% with items = items %}
      {% include "toolkit/browse-list.html" %}
    {% endwith %}
  {% endif %}

  </div>
</div>
{% endblock %}
